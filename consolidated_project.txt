
==================================================
FILE: init_db.py
==================================================

import os
import django

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'my_auth_system.settings')
django.setup()

from core.models import Role, BusinessObject, AccessRule, User, UserRole
from core.services import hash_password

def run():
    print("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...")
    
    # 1. –†–æ–ª–∏
    admin_role, _ = Role.objects.get_or_create(name='Admin')
    user_role, _ = Role.objects.get_or_create(name='User')

    # 2. –û–±—ä–µ–∫—Ç—ã
    obj_product, _ = BusinessObject.objects.get_or_create(name='PRODUCT')
    obj_profile, _ = BusinessObject.objects.get_or_create(name='USER_PROFILE')
    obj_rules, _ = BusinessObject.objects.get_or_create(name='ACCESS_RULE')

    # 3. –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è –ê–¥–º–∏–Ω–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ–º update_or_create)
    for obj in [obj_product, obj_profile, obj_rules]:
        AccessRule.objects.update_or_create(
            role=admin_role, business_object=obj,
            defaults={
                'can_create': True, 
                'can_read_all': True, 
                'can_update_all': True, 
                'can_delete_all': True
            }
        )

    # 4. –¢–µ—Å—Ç–æ–≤—ã–π –ê–¥–º–∏–Ω
    admin_user, created = User.objects.get_or_create(
        email='admin@test.com',
        defaults={
            'full_name': '–ì–ª–∞–≤–Ω—ã–π –ê–¥–º–∏–Ω',
            'password_hash': hash_password('admin123'),
            'is_active': True
        }
    )
    # –ï—Å–ª–∏ –∞–¥–º–∏–Ω —É–∂–µ –±—ã–ª, –Ω–æ –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω - –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º
    if not created:
        admin_user.is_active = True
        admin_user.save()

    UserRole.objects.get_or_create(user=admin_user, role=admin_role)
    
    print("–ì–æ—Ç–æ–≤–æ! –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞.")

if __name__ == '__main__':
    run()


==================================================
FILE: manage.py
==================================================

#!/usr/bin/env python
"""Django's command-line utility for administrative tasks."""
import os
import sys


def main():
    """Run administrative tasks."""
    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'my_auth_system.settings')
    try:
        from django.core.management import execute_from_command_line
    except ImportError as exc:
        raise ImportError(
            "Couldn't import Django. Are you sure it's installed and "
            "available on your PYTHONPATH environment variable? Did you "
            "forget to activate a virtual environment?"
        ) from exc
    execute_from_command_line(sys.argv)


if __name__ == '__main__':
    main()



==================================================
FILE: README.md
==================================================

# Custom RBAC Authentication & Authorization System

## üìå –û –ø—Ä–æ–µ–∫—Ç–µ
–î–∞–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –∫–∞—Å—Ç–æ–º–Ω—É—é —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–æ–º –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–æ–ª–µ–π (**RBAC**), —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é –Ω–∞ **Django** –∏ **Django Rest Framework**. 

–ì–ª–∞–≤–Ω–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å ‚Äî –ø–æ–ª–Ω—ã–π –æ—Ç–∫–∞–∑ –æ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Django (contrib.auth) –≤ –ø–æ–ª—å–∑—É —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≥–∏–±–∫–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ª—é–±—ã–º –±–∏–∑–Ω–µ—Å-–æ–±—ä–µ–∫—Ç–∞–º —á–µ—Ä–µ–∑ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã –¥–æ—Å—Ç—É–ø–∞
–î–æ—Å—Ç—É–ø –≤ —Å–∏—Å—Ç–µ–º–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Å–≤—è–∑–∫–æ–π —á–µ—Ç—ã—Ä–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π:

1.  **User**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∏—Å—Ç–µ–º—ã. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **Soft Delete** (–º—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ) —á–µ—Ä–µ–∑ —Ñ–ª–∞–≥ `is_active`.
2.  **Role**: –†–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `Admin`, `User`, `Manager`).
3.  **BusinessObject**: –†–µ—Å—É—Ä—Å —Å–∏—Å—Ç–µ–º—ã, –¥–æ—Å—Ç—É–ø –∫ –∫–æ—Ç–æ—Ä–æ–º—É –Ω—É–∂–Ω–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, `PRODUCT`, `ACCESS_RULE`).
4.  **AccessRule**: –¶–µ–Ω—Ç—Ä —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∞–º–∏. –°–æ–¥–µ—Ä–∂–∏—Ç –±—É–ª–µ–≤—ã —Ñ–ª–∞–≥–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –¥–ª—è –∫–∞–∂–¥–æ–π —Ä–æ–ª–∏ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –æ–±—ä–µ–∫—Ç:
    *   `can_create` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ.
    *   `can_read_all` / `can_read_own` ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∏–ª–∏ —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏—Ö –∑–∞–ø–∏—Å–µ–π.
    *   `can_update_all` / `can_update_own` ‚Äî —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.
    *   `can_delete_all` / `can_delete_own` ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ.

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
*   **–ü–∞—Ä–æ–ª–∏**: –•–µ—à–∏—Ä—É—é—Ç—Å—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∞–ª–≥–æ—Ä–∏—Ç–º–∞ **bcrypt**.
*   **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è **JWT-—Ç–æ–∫–µ–Ω—ã** (JSON Web Token). 
*   **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –í–º–µ—Å—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ Middleware —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–∞—Å—Ç–æ–º–Ω—ã–π –∫–ª–∞—Å—Å `CustomJWTAuthentication` –≤ DRF, –∫–æ—Ç–æ—Ä—ã–π –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ç–æ–∫–µ–Ω –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ `Authorization: Bearer <token>` –∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫
*   **Python 3.x**
*   **Django 5.x / 6.x**
*   **Django Rest Framework**
*   **PyJWT** (—Ä–∞–±–æ—Ç–∞ —Å —Ç–æ–∫–µ–Ω–∞–º–∏)
*   **bcrypt** (—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π)
*   **SQLite** (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

## 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–°–∫–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
pip install django djangorestframework pyjwt bcrypt requests

## 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
–í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞—Å—Ç –±–∞–∑–æ–≤—ã–µ —Ä–æ–ª–∏, –æ–±—ä–µ–∫—Ç—ã –∏ —É—á–µ—Ç–Ω—É—é –∑–∞–ø–∏—Å—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:
python manage.py migrate
python init_db.py
–î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞ –∞–¥–º–∏–Ω–∞: admin@test.com / admin123

## 3. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
python manage.py runserver

## 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ª–æ–≥–∏–Ω, –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤, –º—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ) –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç:
python test_api.py

## üìã API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã
–ú–µ—Ç–æ–¥	–≠–Ω–¥–ø–æ–∏–Ω—Ç	        –û–ø–∏—Å–∞–Ω–∏–µ	                        –î–æ—Å—Ç—É–ø
POST    /api/register/	    –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è	    –í—Å–µ–º
POST    /api/login/	        –í—Ö–æ–¥ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ JWT-—Ç–æ–∫–µ–Ω–∞	        –í—Å–µ–º
GET	    /api/profile/	    –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å–≤–æ–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è	    –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ
PATCH   /api/profile/	    –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–≤–æ–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è	    –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ
DELETE  /api/profile/	    –ú—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞	        –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ
GET     /api/admin/rules/	–°–ø–∏—Å–æ–∫ –ø—Ä–∞–≤–∏–ª –¥–æ—Å—Ç—É–ø–∞	            –¢–æ–ª—å–∫–æ –ê–¥–º–∏–Ω
GET     /api/products/	    –ü—Ä–∏–º–µ—Ä –±–∏–∑–Ω–µ—Å-–æ–±—ä–µ–∫—Ç–∞	            –ü–æ –ø—Ä–∞–≤–∏–ª–∞–º RBAC

## ‚öôÔ∏è –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ (Services)
–í—Å—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ core/services.py. 
–§—É–Ω–∫—Ü–∏—è has_permission —Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —Ä–∞–∑—Ä–µ—à–µ–Ω–æ –ª–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞. 
–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è 401, –µ—Å–ª–∏ –ø—Ä–∞–≤ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ‚Äî 403 Forbidden.


==================================================
FILE: test_api.py
==================================================

import requests
import json

BASE_URL = "http://127.0.0.1:8000/api"

def print_res(name, response):
    status = response.status_code
    color = "\033[92m" if status < 400 else "\033[91m"
    reset = "\033[0m"
    print(f"[*] Test: {name}")
    print(f"    Status: {color}{status}{reset}")
    try:
        print(f"    Response: {response.json()}")
    except:
        print(f"    Response: {response.text}")
    print("-" * 40)

def run_tests():
    # 1. –¢–µ—Å—Ç –ê–¥–º–∏–Ω–∞ (—Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ —á–µ—Ä–µ–∑ init_db.py)
    print("\n--- PHASE 1: ADMIN CHECK ---")
    admin_login_data = {"email": "admin@test.com", "password": "admin123"}
    resp = requests.post(f"{BASE_URL}/login/", json=admin_login_data)
    print_res("Admin Login", resp)
    admin_token = resp.json().get('token')
    admin_headers = {"Authorization": f"Bearer {admin_token}"}

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–∞–≤–∏–ª–∞–º (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞)
    resp = requests.get(f"{BASE_URL}/admin/rules/", headers=admin_headers)
    print_res("Admin Get Access Rules", resp)

    # 2. –¢–µ—Å—Ç –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    print("\n--- PHASE 2: USER LIFECYCLE ---")
    new_user = {
        "full_name": "Test User",
        "email": "tester@test.com",
        "password_hash": "pass123",
        "password_repeat": "pass123"
    }
    resp = requests.post(f"{BASE_URL}/register/", json=new_user)
    print_res("User Registration", resp)

    # –õ–æ–≥–∏–Ω
    login_data = {"email": "tester@test.com", "password": "pass123"}
    resp = requests.post(f"{BASE_URL}/login/", json=login_data)
    print_res("User Login", resp)
    user_token = resp.json().get('token')
    user_headers = {"Authorization": f"Bearer {user_token}"}

    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è
    resp = requests.get(f"{BASE_URL}/profile/", headers=user_headers)
    print_res("Get Profile", resp)

    # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è (PATCH)
    resp = requests.patch(f"{BASE_URL}/profile/", json={"full_name": "Updated Tester"}, headers=user_headers)
    print_res("Update Profile", resp)

    # 3. –¢–µ—Å—Ç –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (403 Forbidden)
    print("\n--- PHASE 3: RBAC CHECK ---")
    # –û–±—ã—á–Ω—ã–π —é–∑–µ—Ä –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –∞–¥–º–∏–Ω–∞
    resp = requests.get(f"{BASE_URL}/admin/rules/", headers=user_headers)
    print_res("User access Admin Rules (Should be 403)", resp)

    # 4. –¢–µ—Å—Ç –ú—è–≥–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
    print("\n--- PHASE 4: SOFT DELETE ---")
    resp = requests.delete(f"{BASE_URL}/profile/", headers=user_headers)
    print_res("Soft Delete Account", resp)

    # –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è —É–¥–∞–ª–µ–Ω–Ω—ã–º –∞–∫–∫–∞—É–Ω—Ç–æ–º
    resp = requests.post(f"{BASE_URL}/login/", json=login_data)
    print_res("Login after delete (Should be 401)", resp)

if __name__ == "__main__":
    try:
        run_tests()
    except Exception as e:
        print(f"Connection error: {e}. Is server running?")


==================================================
FILE: TZ.txt
==================================================

–¢–µ—Å—Ç–æ–≤–æ–µ –ó–∞–¥–∞–Ω–∏–µ


–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å backend-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Äì —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é —Å–∏—Å—Ç–µ-–º—É –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö —Ñ—Ä–µ–π–º–≤–æ—Ä-–∫–æ–≤, –∏–¥—É—â–∏—Ö ¬´–∏–∑ –∫–æ—Ä–æ–±–∫–∏¬ª.
–û—Å–Ω–æ–≤–Ω–æ–π –∑–∞–¥–∞—á–µ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–æ–¥—É–º—ã–≤–∞–Ω–∏–µ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ—Å—É—Ä—Å–∞–º (–í—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–¥—É–º–∞—Ç—å —Å—Ö–µ–º—É –ë–î, –æ–ø–∏—Å–∞—Ç—å –µ–µ —Å–æ—Å—Ç–∞–≤–ª—è—é—â–∏–µ , –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –æ—Ç—Ä–∞–∂–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞, –∫ –∫–∞-–∫–∏–º —Ä–µ—Å—É—Ä—Å–∞–º –∏ –∫–∞–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è –º–æ–∂–µ—Ç —Å–æ–≤–µ—Ä—à–∞—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ-–≤–∞—Ç–µ–ª—å).
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
–û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ —Å–∏—Å—Ç–µ–º—ã
1. –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
–ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è, –≤—Ö–æ–¥–∏—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É, –≤—ã—Ö–æ–¥–∏—Ç—å –∏–∑ —É—á–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏, –æ–±–Ω–æ–≤–ª—è—Ç—å —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ –∏ —É–¥–∞–ª—è—Ç—å –∞–∫–∫–∞—É–Ω—Ç.
ÔÅ¨	–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: –í–≤–æ–¥ –∏–º–µ–Ω–∏ (—Ñ–∞–º–∏–ª–∏–∏, –æ—Ç—á–µ—Å—Ç–≤–∞), email, –ø–∞—Ä–æ–ª—è, –ø–æ–≤—Ç–æ—Ä –ø–∞—Ä–æ–ª—è.
ÔÅ¨	–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å.
ÔÅ¨	–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: –£–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ (–º—è–≥–∫–æ–µ) ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç —É–¥–∞–ª–µ–Ω–∏–µ, –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç logout, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–æ–ª—å—à–µ –Ω–µ –º–æ-–∂–µ—Ç –∑–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è, –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º –≤ –±–∞–∑–µ —É—á–µ—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å –æ—Å—Ç–∞–µ—Ç—Å—è —Å–æ —Å—Ç–∞—Ç—É-—Å–æ–º is_active=False.
ÔÅ¨	Login: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Ö–æ–¥–∏—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É –ø–æ email –∏ –ø–∞—Ä–æ–ª—é.
ÔÅ¨	Logout: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ —Å–∏—Å—Ç–µ–º—ã.
* –ü–æ—Å–ª–µ login —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–∏ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –æ–±—Ä–∞—â–µ–Ω–∏—è—Ö –¥–æ–ª–∂–Ω–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ-–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
2. –°–∏—Å—Ç–µ–º–∞ —Ä–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞. 
ÔÅ¨	–í—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–¥—É–º–∞—Ç—å –∏ –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ñ–∞–π–ª–µ –∏–ª–∏ –≤ REAME.md –æ–ø–∏—Å–∞—Ç—å —Å—Ö–µ–º—É –≤–∞—à–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ –¥–æ—Å—Ç—É–ø–∞.
ÔÅ¨	–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã –≤ –ë–î.
ÔÅ¨	–¢–∞–±–ª–∏—Ü—ã –∑–∞–ø–æ–ª–Ω–µ–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –¥–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –æ—Ç—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—â–µ–π —Å–∏—Å—Ç–µ–º—ã.
ÔÅ¨	–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Ä–µ—Å—É—Ä—Å—É –ø–æ –≤—ã—à–µ–æ–ø–∏—Å–∞–Ω–Ω—ã–º –ø—Ä–∞–≤–∏-–ª–∞–º, –µ–º—É –≤—ã–¥–∞–µ—Ç—Å—è –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–π —Ä–µ—Å—É—Ä—Å. –ï—Å–ª–∏ –ø–æ –≤—Ö–æ–¥—è—â–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–µ —É–¥–∞–µ—Ç—Å—è –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∑–∞–ª–æ–≥–∏–Ω–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –≤—ã–¥–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ 401. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω, –Ω–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–π —Ä–µ—Å—É—Ä—Å –µ–º—É –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω 403 –æ—à–∏–±–∫–∞ ‚Äî Forbidden. 
ÔÅ¨	–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å API —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø–æ–ª—É—á–µ–Ω–∏—è –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —ç—Ç–∏—Ö –ø—Ä–∞–≤–∏–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, –∏–º–µ—é—â–µ–º—É —Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.

3. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –≤—ã–º—ã—à–ª–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –±–∏–∑–Ω–µ—Å-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∫ –∫–æ—Ç–æ—Ä—ã–º –º–æ–≥–ª–∞ –±—ã –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è —Å–æ–∑–¥–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞.
–¢–∞–±–ª–∏—Ü—ã –≤ –ë–î —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è. –ú–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—Å–∞—Ç—å Mock-View, –∫–æ-—Ç–æ—Ä—ã–µ –ø–æ –æ–±—Ä–∞—â–µ–Ω–∏—è–º –±—É–¥—É—Ç –≤—ã–¥–∞–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–Ω—ã–µ –≤—ã—à–µ –æ—à–∏–±–∫–∏.

–í—ã–±–æ—Ä —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –Ω–∞ –í–∞—à–µ —É—Å–º–æ—Ç—Ä–µ–Ω–∏–µ. –ù–∞—à —Å–æ–≤–µ—Ç ‚Äî DRF + Postgres.

P.S. –î–∞–∂–µ –µ—Å–ª–∏ –Ω–µ —É–¥–∞—Å—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ, —É –æ–±—É—á–∞—é—â–µ–≥–æ-—Å—è –ø–æ—è–≤–∏—Ç—Å—è –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Ä–∞–∑–ª–∏—á–∏–π –º–µ–∂–¥—É –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏-–µ–π, –∑–Ω–∞–Ω–∏—è –æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ jwt-—Ç–æ–∫–µ–Ω–æ–≤, —á—Ç–æ —Ç–∞–∫–æ–µ —Å–µ—Å—Å–∏–∏, –∫–∞–∫ –æ–Ω–∏ —Å–≤—è–∑–∞-–Ω—ã —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏ –∏ –æ—Ç–≤–µ—Ç–∞–º–∏ –∫–ª–∏–µ–Ω—Ç–∞ –∏ —Å–µ—Ä–≤–µ—Ä–∞, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç login –∏ logout –≤ —Å–∏—Å—Ç–µ–º–∞—Ö, –∫–∞–∫ –º–æ–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é –ª—é–±–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.



–ï—Å–ª–∏ –≤—ã –¥–æ–ª–∏—Å—Ç–∞–ª–∏ –¥–æ —ç—Ç–æ–≥–æ –º–µ—Å—Ç–∞ –∏ –≤–∞–º –∫–∞–∂–µ—Ç—Å—è, —á—Ç–æ –∑–∞–¥–∞–Ω–∏–µ –æ—á–µ–Ω—å —Å–ª–æ–∂–Ω–æ–µ –∏ –≤–∞–º –ø–æ–∫–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–Ω–∞–Ω–∏–π, —á—Ç–æ–±—ã –ø—Ä–∏–¥—É–º–∞—Ç—å —Ç–∞–∫—É—é —Ä–µ–∞–ª–∏-–∑–∞—Ü–∏—é, –ø–æ–º–µ–Ω—è–π—Ç–µ —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –≤ —Å—Ç—Ä–æ–∫–∞—Ö –Ω–∏–∂–µ.

–ü—Ä–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é:
–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø–∞—Ä–æ–ª—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î –ø–æ–º–æ–∂–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ bcrypt.
–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –∏–∑ id –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–º–æ–∂–µ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ jwt.
–ú–æ–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ header Authorization : Bearer {user_token}, –ª–∏–±–æ –ø–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–µ—Å—Å–∏—é (–¥–æ–ø —Ç–∞–±–ª–∏—Ü–∞ sessions, –∏ –≤ response —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é Cookie —Å sessionid, expire_at ‚Ä¶
–í request —Å—Ä–∞–∑—É –ø—Ä–∏—Å–≤–∞–∏–≤–∞—Ç—å request.user –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∑–∞–ø—Ä–æ—Å–∞ –≤ –∫–∞—Å—Ç–æ–º–Ω–æ–º Middleware –≤ Django.

–ü—Ä–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é:
–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã:
roles –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ä–æ–ª–µ–π –≤ –ø—Ä–æ–µ–∫—Ç–µ (–∞–¥–º–∏–Ω, –º–µ–Ω–µ–¥–∂–µ—Ä, –ø–æ–ª—å–∑–æ–≤–∞-—Ç–µ–ª—å, –≥–æ—Å—Ç—å);
business_elements –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∫ –∫–æ—Ç–æ—Ä—ã–º –±—É–¥–µ—Ç –æ—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å-—Å—è –¥–æ—Å—Ç—É–ø (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, —Ç–æ–≤–∞—Ä—ã, –º–∞–≥–∞–∑–∏–Ω—ã, –∑–∞–∫–∞–∑—ã, —Å–∞–º–∏ –ø—Ä–∞–≤–∏–ª–∞ –¥–æ—Å—Ç—É–ø–∞);
access_roles_rules –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª –¥–æ—Å—Ç—É–ø–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Ä–æ–ª–∏ –∫ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º—É –±–ª–æ–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—Å—Ç–æ–ª–±—Ü—ã role_id, element_id, read_permission, read_all_permission, create_permission,update_permission, update_all_permission, delete_permission, de-lete_all_permission).
–í—Å–µ —Å—Ç–æ–ª–±—Ü—ã, –æ–∫–∞–Ω—á–∏–≤–∞—é—â–∏–µ—Å—è –Ω–∞ _permission, –∏–º–µ—é—Ç —Ç–∏–ø bool –∏ –æ—Ç—Ä–∞–∂–∞—é—Ç, —á—Ç–æ –ø–æ–ª—å-–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å —Å –æ–±—ä–µ–∫—Ç–∞–º–∏ ‚Äî —Å–æ –≤—Å–µ–º–∏ –æ–±—ä–∫—Ç–∞–º–∏, –∏–ª–∏ –º–æ–∂–µ—Ç —á—Ç–æ-—Ç–æ –¥–µ–ª–∞—Ç—å —Å –æ–±—ä–µ–∫—Ç–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–∑–¥–∞–≤–∞–ª —Å–∞–º (–ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –≤ —Ç–∞–±–ª–∏—á–∫–∞—Ö –±—ã–ª–∏ –±—ã –ø–æ–ª—è owner (—Å—Å—ã–ª–∫–∞ –Ω–∞ user.id)



==================================================
FILE: core\admin.py
==================================================

from django.contrib import admin

# Register your models here.



==================================================
FILE: core\apps.py
==================================================

from django.apps import AppConfig


class CoreConfig(AppConfig):
    name = 'core'



==================================================
FILE: core\middleware.py
==================================================

# –≠—Ç–æ—Ç —Ñ–∞–π–ª –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, —Ç–∞–∫ –∫–∞–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ 
# –≤ core/authentication.py –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å DRF.
class CustomAuthMiddleware:
    def __init__(self, get_response):
        self.get_response = get_response

    def __call__(self, request):
        return self.get_response(request)


==================================================
FILE: core\models.py
==================================================

from django.db import models

class User(models.Model):
    full_name = models.CharField(max_length=255)
    email = models.EmailField(unique=True)
    password_hash = models.CharField(max_length=255)
    is_active = models.BooleanField(default=True)

class Role(models.Model):
    name = models.CharField(max_length=50, unique=True)

class UserRole(models.Model):
    user = models.ForeignKey(User, on_delete=models.CASCADE)
    role = models.ForeignKey(Role, on_delete=models.CASCADE)

class BusinessObject(models.Model):
    name = models.CharField(max_length=100, unique=True)

class AccessRule(models.Model):
    role = models.ForeignKey(Role, on_delete=models.CASCADE)
    business_object = models.ForeignKey(BusinessObject, on_delete=models.CASCADE)
    can_create = models.BooleanField(default=False)
    can_read_all = models.BooleanField(default=False)
    can_read_own = models.BooleanField(default=False)
    can_update_all = models.BooleanField(default=False)
    can_update_own = models.BooleanField(default=False)
    can_delete_all = models.BooleanField(default=False)
    can_delete_own = models.BooleanField(default=False)


==================================================
FILE: core\serializers.py
==================================================

from rest_framework import serializers
from .models import User, AccessRule, Role

class UserRegisterSerializer(serializers.ModelSerializer):
    password_repeat = serializers.CharField(write_only=True)

    class Meta:
        model = User
        fields = ['full_name', 'email', 'password_hash', 'password_repeat']
        extra_kwargs = {'password_hash': {'write_only': True}}

    def validate(self, data):
        if data['password_hash'] != data['password_repeat']:
            raise serializers.ValidationError("–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç")
        return data

class UserUpdateSerializer(serializers.ModelSerializer):
    class Meta:
        model = User
        fields = ['full_name', 'email']

class AccessRuleSerializer(serializers.ModelSerializer):
    class Meta:
        model = AccessRule
        fields = '__all__'


==================================================
FILE: core\services.py
==================================================

import jwt
import bcrypt
from datetime import datetime, timedelta
from django.conf import settings
from rest_framework import authentication
from .models import User, UserRole, AccessRule

# --- –ö–õ–ê–°–° –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–ò –î–õ–Ø DRF ---
class CustomJWTAuthentication(authentication.BaseAuthentication):
    def authenticate(self, request):
        auth_header = request.headers.get('Authorization')
        
        if not auth_header or not auth_header.startswith('Bearer '):
            return None

        token = auth_header.split(' ')[1]
        try:
            payload = jwt.decode(token, settings.SECRET_KEY, algorithms=['HS256'])
            user = User.objects.get(id=payload['user_id'], is_active=True)
            return (user, token)
        except (jwt.ExpiredSignatureError, jwt.DecodeError, User.DoesNotExist):
            return None

    def authenticate_header(self, request):
        return 'Bearer'

# --- –¢–í–û–ò –§–£–ù–ö–¶–ò–ò ---
def hash_password(password: str):
    return bcrypt.hashpw(password.encode(), bcrypt.gensalt()).decode()

def check_password(password: str, hashed: str):
    return bcrypt.checkpw(password.encode(), hashed.encode())

def create_token(user_id):
    payload = {
        'user_id': user_id,
        'exp': datetime.utcnow() + timedelta(days=1)
    }
    return jwt.encode(payload, settings.SECRET_KEY, algorithm='HS256')

def has_permission(user, object_name, action, owner_id=None):
    if not isinstance(user, User):
        return False
    
    user_roles = UserRole.objects.filter(user=user).values_list('role_id', flat=True)
    rules = AccessRule.objects.filter(role_id__in=user_roles, business_object__name=object_name)
    
    for rule in rules:
        if action == 'create' and rule.can_create: return True
        if action == 'read' and rule.can_read_all: return True
        if action == 'update' and rule.can_update_all: return True
        if action == 'delete' and rule.can_delete_all: return True
        if owner_id and user.id == owner_id:
            if action == 'read' and rule.can_read_own: return True
            if action == 'update' and rule.can_update_own: return True
            if action == 'delete' and rule.can_delete_own: return True
    return False


==================================================
FILE: core\tests.py
==================================================

from django.test import TestCase

# Create your tests here.



==================================================
FILE: core\views.py
==================================================

from rest_framework.views import APIView
from rest_framework.response import Response
from rest_framework import status, viewsets
from rest_framework.permissions import AllowAny
from .models import User, AccessRule, UserRole, Role
from .services import check_password, create_token, has_permission, hash_password
from .serializers import UserRegisterSerializer, UserUpdateSerializer, AccessRuleSerializer

class RegisterView(APIView):
    authentication_classes = [] # –ü—É—Å—Ç–æ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
    permission_classes = [AllowAny]
    
    def post(self, request):
        serializer = UserRegisterSerializer(data=request.data)
        if serializer.is_valid():
            user = User.objects.create(
                full_name=serializer.validated_data['full_name'],
                email=serializer.validated_data['email'],
                password_hash=hash_password(serializer.validated_data['password_hash'])
            )
            user_role, _ = Role.objects.get_or_create(name='User')
            UserRole.objects.create(user=user, role=user_role)
            return Response({"message": "User created"}, status=status.HTTP_201_CREATED)
        return Response(serializer.errors, status=status.HTTP_400_BAD_REQUEST)

class LoginView(APIView):
    authentication_classes = [] # –ü—É—Å—Ç–æ –¥–ª—è –ª–æ–≥–∏–Ω–∞
    permission_classes = [AllowAny]

    def post(self, request):
        email = request.data.get('email')
        password = request.data.get('password')
        try:
            # –ò—â–µ–º —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö
            user = User.objects.get(email=email, is_active=True)
            if check_password(password, user.password_hash):
                token = create_token(user.id)
                return Response({'token': token})
        except User.DoesNotExist:
            pass
        return Response({'error': 'Invalid credentials'}, status=401)

class LogoutView(APIView):
    def post(self, request):
        return Response({"message": "Successfully logged out"}, status=200)

class UserProfileView(APIView):
    def get(self, request):
        if not request.user: 
            return Response({"error": "Unauthorized"}, status=401)
        return Response({'full_name': request.user.full_name, 'email': request.user.email})

    def patch(self, request):
        if not request.user: 
            return Response({"error": "Unauthorized"}, status=401)
        serializer = UserUpdateSerializer(request.user, data=request.data, partial=True)
        if serializer.is_valid():
            serializer.save()
            return Response(serializer.data)
        return Response(serializer.errors, status=400)

    def delete(self, request):
        if not request.user: 
            return Response({"error": "Unauthorized"}, status=401)
        request.user.is_active = False
        request.user.save()
        return Response({'message': 'Account deactivated'})

class AccessRuleViewSet(viewsets.ModelViewSet):
    queryset = AccessRule.objects.all()
    serializer_class = AccessRuleSerializer

    def list(self, request, *args, **kwargs):
        if not has_permission(request.user, 'ACCESS_RULE', 'read'):
            return Response({"error": "Forbidden"}, status=403)
        return super().list(request, *args, **kwargs)

class ProductMockView(APIView):
    def get(self, request):
        if not request.user: 
            return Response({"error": "Unauthorized"}, status=401)
        if not has_permission(request.user, 'PRODUCT', 'read'):
            return Response({'error': 'Forbidden'}, status=403)
        return Response([{'id': 1, 'name': 'Laptop'}])


==================================================
FILE: core\__init__.py
==================================================




==================================================
FILE: core\migrations\0001_initial.py
==================================================

# Generated by Django 6.0 on 2025-12-27 11:19

import django.db.models.deletion
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
    ]

    operations = [
        migrations.CreateModel(
            name='BusinessObject',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100, unique=True)),
            ],
        ),
        migrations.CreateModel(
            name='Role',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=50, unique=True)),
            ],
        ),
        migrations.CreateModel(
            name='User',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('full_name', models.CharField(max_length=255)),
                ('email', models.EmailField(max_length=254, unique=True)),
                ('password_hash', models.CharField(max_length=255)),
                ('is_active', models.BooleanField(default=True)),
            ],
        ),
        migrations.CreateModel(
            name='AccessRule',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('can_create', models.BooleanField(default=False)),
                ('can_read_all', models.BooleanField(default=False)),
                ('can_read_own', models.BooleanField(default=False)),
                ('can_update_all', models.BooleanField(default=False)),
                ('can_update_own', models.BooleanField(default=False)),
                ('can_delete_all', models.BooleanField(default=False)),
                ('can_delete_own', models.BooleanField(default=False)),
                ('business_object', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.businessobject')),
                ('role', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.role')),
            ],
        ),
        migrations.CreateModel(
            name='UserRole',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('role', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.role')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.user')),
            ],
        ),
    ]



==================================================
FILE: core\migrations\__init__.py
==================================================




==================================================
FILE: my_auth_system\asgi.py
==================================================

"""
ASGI config for my_auth_system project.

It exposes the ASGI callable as a module-level variable named ``application``.

For more information on this file, see
https://docs.djangoproject.com/en/6.0/howto/deployment/asgi/
"""

import os

from django.core.asgi import get_asgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'my_auth_system.settings')

application = get_asgi_application()



==================================================
FILE: my_auth_system\settings.py
==================================================

import os
from pathlib import Path

BASE_DIR = Path(__file__).resolve().parent.parent
SECRET_KEY = 'django-insecure-custom-auth-system-key-2025'
DEBUG = True
ALLOWED_HOSTS = ['*']

INSTALLED_APPS = [
    'django.contrib.contenttypes',
    'django.contrib.staticfiles',
    'rest_framework',
    'core',
]

MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
    # –ú—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–±—Ä–∞–ª–∏ –∫–∞—Å—Ç–æ–º–Ω—ã–π Middleware, —Ç–∞–∫ –∫–∞–∫ DRF –¥–µ–ª–∞–µ—Ç –≤—Å—ë —Å–∞–º
]

ROOT_URLCONF = 'my_auth_system.urls'

TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.request',
            ],
        },
    },
]

WSGI_APPLICATION = 'my_auth_system.wsgi.application'

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}

REST_FRAMEWORK = {
    'DEFAULT_AUTHENTICATION_CLASSES': [
        'core.services.CustomJWTAuthentication', # –ü—É—Ç—å –∫ –∫–ª–∞—Å—Å—É –≤ services.py
    ],
    'DEFAULT_PERMISSION_CLASSES': [
        'rest_framework.permissions.AllowAny',
    ],
    'UNAUTHENTICATED_USER': None,
}

LANGUAGE_CODE = 'ru-ru'
TIME_ZONE = 'UTC'
USE_I18N = True
USE_TZ = True
STATIC_URL = 'static/'
DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'


==================================================
FILE: my_auth_system\urls.py
==================================================

from django.urls import path, include
from rest_framework.routers import DefaultRouter
from core.views import (
    LoginView, RegisterView, LogoutView, 
    UserProfileView, ProductMockView, AccessRuleViewSet
)

router = DefaultRouter()
router.register(r'rules', AccessRuleViewSet, basename='rules')

urlpatterns = [
    path('api/register/', RegisterView.as_view()),
    path('api/login/', LoginView.as_view()),
    path('api/logout/', LogoutView.as_view()),
    path('api/profile/', UserProfileView.as_view()),
    path('api/products/', ProductMockView.as_view()),
    path('api/admin/', include(router.urls)),
]


==================================================
FILE: my_auth_system\wsgi.py
==================================================

"""
WSGI config for my_auth_system project.

It exposes the WSGI callable as a module-level variable named ``application``.

For more information on this file, see
https://docs.djangoproject.com/en/6.0/howto/deployment/wsgi/
"""

import os

from django.core.wsgi import get_wsgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'my_auth_system.settings')

application = get_wsgi_application()



==================================================
FILE: my_auth_system\__init__.py
==================================================



